<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" type="image/png" href="favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¼èˆªé—¨æˆ·</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        // é…ç½®Tailwindè‡ªå®šä¹‰ä¸»é¢˜
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36CFC9',
                        dark: '#1D1D1F',
                        'dark-light': '#2C2C2E',
                        'dark-lighter': '#3A3A3C',
                        'text-primary': '#F5F5F7',
                        'text-secondary': '#AEAEB2'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .scrollbar-hide {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
            .card-hover {
                @apply transition-all duration-300 hover:shadow-lg hover:shadow-primary/20 hover:-translate-y-1;
            }
            .btn-effect {
                @apply transition-all duration-200 active:scale-95;
            }
            .icon-container {
                @apply w-12 h-12 rounded-md bg-dark flex items-center justify-center mb-2 overflow-hidden;
            }
            .default-icon {
                @apply text-xl;
            }
        }
    </style>
</head>

<body class="bg-dark text-text-primary min-h-screen flex flex-col">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="bg-dark-light border-b border-gray-700/50 sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <!-- ç½‘ç«™å›¾æ ‡ -->
                    <div
                        class="w-10 h-10 rounded-lg bg-gradient-to-br from-primary to-secondary flex items-center justify-center mr-3">
                        <span class="text-white font-bold text-xl">ğŸŒ</span>
                    </div>
                    <h1 class="text-xl font-bold text-primary mr-8">å¯¼èˆªé—¨æˆ·</h1>

                    <!-- åˆ†ç»„æ ‡ç­¾æ»šåŠ¨å®¹å™¨ -->
                    <div class="relative overflow-x-auto scrollbar-hide flex-1 max-w-full">
                        <div id="group-tabs" class="flex space-x-1 py-2 min-w-max">
                            <!-- åˆ†ç»„æ ‡ç­¾å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>

                <div class="flex items-center space-x-4">
                    <button id="add-group-btn"
                        class="flex items-center px-3 py-1.5 rounded-md bg-dark-lighter hover:bg-primary/10 text-sm btn-effect">
                        <i class="fa fa-plus mr-1.5"></i> æ–°å¢åˆ†ç»„
                    </button>
                    <button id="settings-btn"
                        class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-dark-lighter btn-effect">
                        <i class="fa fa-cog"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="flex-1 container mx-auto px-4 py-6">
        <!-- å½“å‰åˆ†ç»„æ ‡é¢˜å’Œæ“ä½œ -->
        <div class="flex justify-between items-center mb-6">
            <div>
                <h2 id="current-group-title" class="text-xl font-semibold"></h2>
                <p id="current-group-desc" class="text-text-secondary text-sm mt-1"></p>
            </div>
            <div id="current-group-actions" class="flex space-x-2">
                <button id="edit-group-btn"
                    class="px-3 py-1.5 rounded-md bg-dark-lighter hover:bg-primary/10 text-sm flex items-center btn-effect">
                    <i class="fa fa-pencil mr-1.5"></i> ç¼–è¾‘åˆ†ç»„
                </button>
                <button id="delete-group-btn"
                    class="px-3 py-1.5 rounded-md bg-dark-lighter hover:bg-red-500/20 text-sm text-red-400 flex items-center btn-effect">
                    <i class="fa fa-trash mr-1.5"></i> åˆ é™¤åˆ†ç»„
                </button>
                <button id="add-item-btn"
                    class="px-3 py-1.5 rounded-md bg-primary hover:bg-primary/90 text-sm flex items-center btn-effect">
                    <i class="fa fa-plus mr-1.5"></i> æ–°å¢åº”ç”¨
                </button>
            </div>
        </div>

        <!-- åº”ç”¨ç½‘æ ¼ -->
        <div id="apps-grid"
            class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 2xl:grid-cols-8 gap-4">
        </div>
    </main>

    <!-- é¡µè„š -->
    <footer class="bg-dark-light border-t border-gray-700/50 py-4">
        <div class="container mx-auto px-4 text-center text-text-secondary text-sm">
            <p>å¯¼èˆªé—¨æˆ·</p>
        </div>
    </footer>

    <!-- æ–°å¢/ç¼–è¾‘åˆ†ç»„æ¨¡æ€æ¡† -->
    <div id="group-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden">
        <div class="bg-dark-light rounded-lg shadow-xl w-full max-w-md p-6 transform transition-all">
            <div class="flex justify-between items-center mb-4">
                <h3 id="group-modal-title" class="text-lg font-semibold">æ–°å¢åˆ†ç»„</h3>
                <button id="close-group-modal" class="text-text-secondary hover:text-text-primary btn-effect">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <form id="group-form">
                <input type="hidden" id="group-id">
                <div class="mb-4">
                    <label for="group-name" class="block text-sm font-medium mb-1.5">åˆ†ç»„åç§°</label>
                    <input type="text" id="group-name"
                        class="w-full px-3 py-2 bg-dark border border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary text-text-primary"
                        required>
                </div>
                <div class="mb-6">
                    <label for="group-desc" class="block text-sm font-medium mb-1.5">åˆ†ç»„æè¿° (å¯é€‰)</label>
                    <input type="text" id="group-desc"
                        class="w-full px-3 py-2 bg-dark border border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary text-text-primary">
                </div>
                <div class="flex justify-end space-x-3">
                    <button type="button" id="cancel-group-btn"
                        class="px-4 py-2 border border-gray-700 rounded-md hover:bg-dark-lighter btn-effect">å–æ¶ˆ</button>
                    <button type="submit"
                        class="px-4 py-2 bg-primary rounded-md hover:bg-primary/90 btn-effect">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- æ–°å¢/ç¼–è¾‘åº”ç”¨æ¨¡æ€æ¡† -->
    <div id="item-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden">
        <div class="bg-dark-light rounded-lg shadow-xl w-full max-w-md p-6 transform transition-all">
            <div class="flex justify-between items-center mb-4">
                <h3 id="item-modal-title" class="text-lg font-semibold">æ–°å¢åº”ç”¨</h3>
                <button id="close-item-modal" class="text-text-secondary hover:text-text-primary btn-effect">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <form id="item-form">
                <input type="hidden" id="item-id">
                <input type="hidden" id="item-group-id">
                <div class="mb-4">
                    <label for="item-name" class="block text-sm font-medium mb-1.5">åº”ç”¨åç§°</label>
                    <input type="text" id="item-name"
                        class="w-full px-3 py-2 bg-dark border border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary text-text-primary"
                        required>
                </div>
                <div class="mb-4">
                    <label for="item-url" class="block text-sm font-medium mb-1.5">åº”ç”¨ç½‘å€</label>
                    <input type="url" id="item-url"
                        class="w-full px-3 py-2 bg-dark border border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary text-text-primary"
                        placeholder="https://" required>
                </div>
                <div class="mb-4">
                    <label for="item-icon" class="block text-sm font-medium mb-1.5">å›¾æ ‡URL (å¯é€‰)</label>
                    <input type="url" id="item-icon"
                        class="w-full px-3 py-2 bg-dark border border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary text-text-primary"
                        placeholder="https://">
                    <p class="text-xs text-text-secondary mt-1">ä¸å¡«å†™åˆ™ä½¿ç”¨ç½‘ç«™é»˜è®¤å›¾æ ‡</p>
                </div>
                <div class="flex justify-end space-x-3">
                    <button type="button" id="cancel-item-btn"
                        class="px-4 py-2 border border-gray-700 rounded-md hover:bg-dark-lighter btn-effect">å–æ¶ˆ</button>
                    <button type="submit"
                        class="px-4 py-2 bg-primary rounded-md hover:bg-primary/90 btn-effect">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ç¡®è®¤åˆ é™¤æ¨¡æ€æ¡† -->
    <div id="confirm-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden">
        <div class="bg-dark-light rounded-lg shadow-xl w-full max-w-md p-6 transform transition-all">
            <div class="text-center mb-5">
                <div
                    class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-red-500/20 text-red-400 mb-4">
                    <i class="fa fa-exclamation-triangle text-2xl"></i>
                </div>
                <h3 id="confirm-title" class="text-lg font-semibold mb-2">ç¡®è®¤åˆ é™¤</h3>
                <p id="confirm-message" class="text-text-secondary">æ‚¨ç¡®å®šè¦åˆ é™¤å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚</p>
            </div>
            <div class="flex justify-center space-x-3">
                <button id="cancel-confirm-btn"
                    class="px-4 py-2 border border-gray-700 rounded-md hover:bg-dark-lighter btn-effect">å–æ¶ˆ</button>
                <button id="confirm-delete-btn"
                    class="px-4 py-2 bg-red-500 rounded-md hover:bg-red-600 btn-effect">åˆ é™¤</button>
            </div>
        </div>
    </div>

    <script>
        // æ•°æ®ç®¡ç†
        const DataManager = {
            // åˆå§‹åŒ–æ•°æ®
            init() {
                const savedData = localStorage.getItem('portalData');
                if (!savedData) {
                    // åˆå§‹æ•°æ® - åŒ…å«æœ€è¿‘è®¿é—®åˆ†ç»„
                    const initialData = {
                        groups: [
                            {
                                id: 'recent',
                                name: 'æœ€è¿‘è®¿é—®',
                                desc: 'æŒ‰è®¿é—®æ—¶é—´æ’åºçš„åº”ç”¨',
                                isDefault: true,
                                items: []
                            },
                        ],
                        currentGroupId: 'recent'
                    };
                    this.saveData(initialData);
                    return initialData;
                }
                return JSON.parse(savedData);
            },

            // ä¿å­˜æ•°æ®åˆ°localStorage
            saveData(data) {
                localStorage.setItem('portalData', JSON.stringify(data));
            },

            // è·å–æ‰€æœ‰æ•°æ®
            getAllData() {
                return this.init();
            },

            // è·å–æ‰€æœ‰åˆ†ç»„
            getGroups() {
                return this.getAllData().groups;
            },

            // è·å–å½“å‰åˆ†ç»„ID
            getCurrentGroupId() {
                return this.getAllData().currentGroupId;
            },

            // è®¾ç½®å½“å‰åˆ†ç»„
            setCurrentGroupId(groupId) {
                const data = this.getAllData();
                data.currentGroupId = groupId;
                this.saveData(data);
            },

            // è·å–å½“å‰åˆ†ç»„
            getCurrentGroup() {
                const data = this.getAllData();
                return data.groups.find(group => group.id === data.currentGroupId);
            },

            // è·å–æŒ‡å®šåˆ†ç»„
            getGroup(groupId) {
                return this.getGroups().find(group => group.id === groupId);
            },

            // æ·»åŠ æ–°åˆ†ç»„
            addGroup(group) {
                const data = this.getAllData();
                const newGroup = {
                    id: 'group_' + Date.now(),
                    isDefault: false,
                    ...group,
                    items: []
                };
                data.groups.push(newGroup);
                this.saveData(data);
                return newGroup;
            },

            // æ›´æ–°åˆ†ç»„
            updateGroup(groupId, updatedData) {
                const data = this.getAllData();
                const index = data.groups.findIndex(group => group.id === groupId);
                if (index !== -1) {
                    // ä¿ç•™åŸæœ‰IDå’ŒisDefaultå±æ€§
                    data.groups[index] = {
                        ...data.groups[index],
                        ...updatedData
                    };
                    this.saveData(data);
                    return data.groups[index];
                }
                return null;
            },

            // åˆ é™¤åˆ†ç»„
            deleteGroup(groupId) {
                const data = this.getAllData();
                // ä¸èƒ½åˆ é™¤é»˜è®¤åˆ†ç»„
                const group = data.groups.find(g => g.id === groupId);
                if (group && group.isDefault) return false;

                const initialGroupId = data.groups[0].id;

                // å¦‚æœåˆ é™¤çš„æ˜¯å½“å‰åˆ†ç»„ï¼Œåˆ‡æ¢åˆ°ç¬¬ä¸€ä¸ªåˆ†ç»„
                if (data.currentGroupId === groupId) {
                    data.currentGroupId = initialGroupId;
                }

                data.groups = data.groups.filter(group => group.id !== groupId);
                this.saveData(data);
                return true;
            },

            // å‘åˆ†ç»„æ·»åŠ åº”ç”¨
            addItem(groupId, item) {
                const data = this.getAllData();
                const groupIndex = data.groups.findIndex(group => group.id === groupId);
                if (groupIndex !== -1) {
                    const newItem = {
                        id: 'item_' + Date.now(),
                        ...item,
                        lastAccessed: new Date().toISOString()
                    };

                    // å¦‚æœä¸æ˜¯æœ€è¿‘è®¿é—®åˆ†ç»„ï¼Œä¹Ÿæ·»åŠ åˆ°æœ€è¿‘è®¿é—®
                    if (groupId !== 'recent') {
                        const recentGroupIndex = data.groups.findIndex(g => g.id === 'recent');
                        if (recentGroupIndex !== -1) {
                            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ï¼Œå­˜åœ¨åˆ™ç§»é™¤æ—§çš„
                            data.groups[recentGroupIndex].items = data.groups[recentGroupIndex].items
                                .filter(i => i.id !== newItem.id);
                            data.groups[recentGroupIndex].items.unshift(newItem);
                            // é™åˆ¶æœ€è¿‘è®¿é—®æ•°é‡ä¸º20
                            if (data.groups[recentGroupIndex].items.length > 20) {
                                data.groups[recentGroupIndex].items.pop();
                            }
                        }
                    }

                    data.groups[groupIndex].items.push(newItem);
                    this.saveData(data);
                    return newItem;
                }
                return null;
            },

            // æ›´æ–°åº”ç”¨
            updateItem(groupId, itemId, updatedData) {
                const data = this.getAllData();
                const groupIndex = data.groups.findIndex(group => group.id === groupId);
                if (groupIndex !== -1) {
                    const itemIndex = data.groups[groupIndex].items.findIndex(item => item.id === itemId);
                    if (itemIndex !== -1) {
                        // ä¿ç•™åŸæœ‰ID
                        const updatedItem = {
                            ...data.groups[groupIndex].items[itemIndex],
                            ...updatedData
                        };

                        data.groups[groupIndex].items[itemIndex] = updatedItem;

                        // å¦‚æœä¸æ˜¯æœ€è¿‘è®¿é—®åˆ†ç»„ï¼ŒåŒæ­¥æ›´æ–°æœ€è¿‘è®¿é—®ä¸­çš„é¡¹ç›®
                        if (groupId !== 'recent') {
                            const recentGroupIndex = data.groups.findIndex(g => g.id === 'recent');
                            if (recentGroupIndex !== -1) {
                                const recentItemIndex = data.groups[recentGroupIndex].items.findIndex(i => i.id === itemId);
                                if (recentItemIndex !== -1) {
                                    data.groups[recentGroupIndex].items[recentItemIndex] = updatedItem;
                                }
                            }
                        }

                        this.saveData(data);
                        return updatedItem;
                    }
                }
                return null;
            },

            // åˆ é™¤åº”ç”¨
            deleteItem(groupId, itemId) {
                const data = this.getAllData();
                const groupIndex = data.groups.findIndex(group => group.id === groupId);
                if (groupIndex !== -1) {
                    data.groups[groupIndex].items = data.groups[groupIndex].items.filter(item => item.id !== itemId);

                    // åŒæ—¶ä»æœ€è¿‘è®¿é—®ä¸­åˆ é™¤
                    const recentGroupIndex = data.groups.findIndex(g => g.id === 'recent');
                    if (recentGroupIndex !== -1) {
                        data.groups[recentGroupIndex].items = data.groups[recentGroupIndex].items.filter(i => i.id !== itemId);
                    }

                    this.saveData(data);
                    return true;
                }
                return false;
            },

            // è®°å½•åº”ç”¨è®¿é—®æ—¶é—´
            recordAccess(itemId) {
                const data = this.getAllData();

                // æŸ¥æ‰¾é¡¹ç›®æ‰€åœ¨çš„åˆ†ç»„
                let itemToUpdate = null;
                let sourceGroupId = null;

                for (const group of data.groups) {
                    const item = group.items.find(i => i.id === itemId);
                    if (item) {
                        itemToUpdate = item;
                        sourceGroupId = group.id;
                        break;
                    }
                }

                if (itemToUpdate && sourceGroupId !== 'recent') {
                    // æ›´æ–°è®¿é—®æ—¶é—´
                    itemToUpdate.lastAccessed = new Date().toISOString();

                    // æ›´æ–°æºåˆ†ç»„ä¸­çš„é¡¹ç›®
                    const sourceGroupIndex = data.groups.findIndex(g => g.id === sourceGroupId);
                    if (sourceGroupIndex !== -1) {
                        const itemIndex = data.groups[sourceGroupIndex].items.findIndex(i => i.id === itemId);
                        if (itemIndex !== -1) {
                            data.groups[sourceGroupIndex].items[itemIndex] = itemToUpdate;
                        }
                    }

                    // æ›´æ–°æœ€è¿‘è®¿é—®åˆ†ç»„
                    const recentGroupIndex = data.groups.findIndex(g => g.id === 'recent');
                    if (recentGroupIndex !== -1) {
                        // å…ˆç§»é™¤æ—§çš„
                        data.groups[recentGroupIndex].items = data.groups[recentGroupIndex].items
                            .filter(i => i.id !== itemId);
                        // æ·»åŠ åˆ°å¼€å¤´
                        data.groups[recentGroupIndex].items.unshift(itemToUpdate);
                        // é™åˆ¶æ•°é‡
                        if (data.groups[recentGroupIndex].items.length > 20) {
                            data.groups[recentGroupIndex].items.pop();
                        }
                    }

                    this.saveData(data);
                    return true;
                }

                return false;
            },

            // æ¸…ç©ºæœ€è¿‘è®¿é—®è®°å½•
            clearRecentItems() {
                const data = this.getAllData();
                const recentGroupIndex = data.groups.findIndex(g => g.id === 'recent');
                if (recentGroupIndex !== -1) {
                    data.groups[recentGroupIndex].items = [];
                    this.saveData(data);
                    return true;
                }
                return false;
            }
        };

        // UIæ¸²æŸ“ç®¡ç†
        const UIManager = {
            // åˆå§‹åŒ–UI
            init() {
                this.renderGroupTabs();
                this.renderCurrentGroup();
                this.setupEventListeners();
            },

            // æ¸²æŸ“åˆ†ç»„æ ‡ç­¾
            renderGroupTabs() {
                const groups = DataManager.getGroups();
                const currentGroupId = DataManager.getCurrentGroupId();
                const groupTabsContainer = document.getElementById('group-tabs');

                groupTabsContainer.innerHTML = '';

                groups.forEach(group => {
                    const tab = document.createElement('button');
                    tab.className = `px-3 py-1.5 rounded-md text-sm whitespace-nowrap btn-effect ${group.id === currentGroupId
                        ? 'bg-primary text-white'
                        : 'bg-dark-lighter hover:bg-primary/10'
                        }`;
                    tab.textContent = group.name;
                    tab.dataset.groupId = group.id;

                    tab.addEventListener('click', () => {
                        DataManager.setCurrentGroupId(group.id);
                        this.renderGroupTabs();
                        this.renderCurrentGroup();
                    });

                    groupTabsContainer.appendChild(tab);
                });
            },

            // æ¸²æŸ“å½“å‰åˆ†ç»„å†…å®¹
            renderCurrentGroup() {
                const currentGroup = DataManager.getCurrentGroup();
                if (!currentGroup) return;

                // æ›´æ–°æ ‡é¢˜å’Œæè¿°
                document.getElementById('current-group-title').textContent = currentGroup.name;
                document.getElementById('current-group-desc').textContent = currentGroup.desc || 'æ— æè¿°';

                // è·å–æŒ‰é’®å®¹å™¨å¹¶æ¸…ç©º
                const actionsContainer = document.getElementById('current-group-actions');
                // ä¿å­˜æ–°å¢åº”ç”¨æŒ‰é’®ï¼Œåé¢ä¼šé‡æ–°æ·»åŠ 
                const addItemBtn = document.getElementById('add-item-btn');
                // æ¸…ç©ºå®¹å™¨
                actionsContainer.innerHTML = '';

                // æ·»åŠ ç¼–è¾‘å’Œåˆ é™¤æŒ‰é’®
                const editBtn = document.createElement('button');
                editBtn.id = 'edit-group-btn';
                editBtn.className = `px-3 py-1.5 rounded-md bg-dark-lighter hover:bg-primary/10 text-sm flex items-center btn-effect ${currentGroup.isDefault ? 'opacity-50' : ''}`;
                editBtn.disabled = currentGroup.isDefault;
                editBtn.innerHTML = '<i class="fa fa-pencil mr-1.5"></i> ç¼–è¾‘åˆ†ç»„';
                editBtn.addEventListener('click', () => this.openEditGroupModal());

                const deleteBtn = document.createElement('button');
                deleteBtn.id = 'delete-group-btn';
                deleteBtn.className = `px-3 py-1.5 rounded-md bg-dark-lighter hover:bg-red-500/20 text-sm text-red-400 flex items-center btn-effect ${currentGroup.isDefault ? 'opacity-50' : ''}`;
                deleteBtn.disabled = currentGroup.isDefault;
                deleteBtn.innerHTML = '<i class="fa fa-trash mr-1.5"></i> åˆ é™¤åˆ†ç»„';
                deleteBtn.addEventListener('click', () => this.openDeleteGroupConfirm());

                // å¦‚æœæ˜¯æœ€è¿‘è®¿é—®åˆ†ç»„ï¼Œæ·»åŠ æ¸…ç©ºæŒ‰é’®
                if (currentGroup.id === 'recent') {
                    const clearBtn = document.createElement('button');
                    clearBtn.id = 'clear-recent-btn';
                    clearBtn.className = 'px-3 py-1.5 rounded-md bg-dark-lighter hover:bg-red-500/20 text-sm text-red-400 flex items-center btn-effect';
                    clearBtn.innerHTML = '<i class="fa fa-trash mr-1.5"></i> æ¸…ç©ºå†å²';
                    clearBtn.addEventListener('click', () => this.openClearRecentConfirm());
                    actionsContainer.appendChild(clearBtn);
                }

                // æ·»åŠ ç¼–è¾‘ã€åˆ é™¤å’Œæ–°å¢æŒ‰é’®
                actionsContainer.appendChild(editBtn);
                actionsContainer.appendChild(deleteBtn);
                actionsContainer.appendChild(addItemBtn);

                // æ¸²æŸ“åº”ç”¨åˆ—è¡¨
                this.renderApps(currentGroup.items);
            },

            // æ¸²æŸ“åº”ç”¨åˆ—è¡¨
            renderApps(items) {
                const appsGrid = document.getElementById('apps-grid');
                const currentGroup = DataManager.getCurrentGroup();

                if (items.length == 0) {
                    if (currentGroup.id === 'recent') {
                        // é‡ç½®åº”ç”¨åˆ—è¡¨
                        appsGrid.innerHTML = `<!-- åº”ç”¨å¡ç‰‡å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                            <div class="col-span-full flex items-center justify-center py-16 text-text-secondary">
                                <div class="text-center">
                                    <i class="fa fa-clock-o text-4xl mb-3 opacity-30"></i>
                                    <p>æš‚æ— æœ€è¿‘è®¿é—®è®°å½•</p>
                                </div>
                            </div>`
                    } else {
                        // é‡ç½®åº”ç”¨åˆ—è¡¨
                        appsGrid.innerHTML = `<!-- åº”ç”¨å¡ç‰‡å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                            <div class="col-span-full flex items-center justify-center py-16 text-text-secondary">
                                <div class="text-center">
                                    <i class="fa fa-grid-o text-4xl mb-3 opacity-30"></i>
                                    <p>è¯·æ·»åŠ åº”ç”¨åˆ°å½“å‰åˆ†ç»„</p>
                                </div>
                            </div>`
                    }
                } else {
                    // é‡ç½®åº”ç”¨åˆ—è¡¨
                    appsGrid.innerHTML = ""
                }


                // å¯¹æœ€è¿‘è®¿é—®åˆ†ç»„æŒ‰è®¿é—®æ—¶é—´æ’åº
                let sortedItems = [...items];
                if (currentGroup.id === 'recent') {
                    sortedItems.sort((a, b) => new Date(b.lastAccessed) - new Date(a.lastAccessed));
                }

                sortedItems.forEach((item, index) => {
                    const appCard = document.createElement('div');
                    appCard.className = 'bg-dark-light rounded-lg p-3 card-hover group relative overflow-hidden';

                    // åˆ›å»ºå›¾æ ‡å®¹å™¨
                    const iconContainer = document.createElement('div');
                    iconContainer.id = `app-icon-${index}`
                    iconContainer.className = 'icon-container';

                    // ç”Ÿæˆé»˜è®¤å›¾æ ‡URLï¼ˆä½¿ç”¨ç½‘ç«™åŸŸåçš„faviconï¼‰
                    let iconUrl = item.icon;
                    if (!iconUrl) {
                        try {
                            const url = new URL(item.url);
                            iconUrl = `https://${url.hostname}/favicon.ico`;
                        } catch (e) {
                            iconUrl = ''; // å°†ä½¿ç”¨é»˜è®¤å›¾æ ‡
                        }
                    }

                    // åˆ›å»ºå›¾ç‰‡å…ƒç´ å¹¶æ£€æµ‹åŠ è½½çŠ¶æ€
                    if (iconUrl) {
                        const img = document.createElement('img');
                        img.src = iconUrl;
                        img.alt = `${item.name}å›¾æ ‡`;
                        img.className = 'w-full h-full object-contain';

                        // å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºé»˜è®¤å›¾æ ‡
                        img.addEventListener('error', (e) => {
                            let iconContainer = document.getElementById("app-icon-" + index)
                            iconContainer.innerHTML = '<span class="default-icon">ğŸŒ</span>';
                        });

                        iconContainer.appendChild(img);
                    } else {
                        // æ²¡æœ‰å›¾æ ‡URLæ—¶ç›´æ¥æ˜¾ç¤ºé»˜è®¤å›¾æ ‡
                        iconContainer.innerHTML = '<span class="default-icon">ğŸŒ</span>';
                    }

                    // æ„å»ºåº”ç”¨å¡ç‰‡å†…å®¹
                    appCard.innerHTML = `
                        <div class="flex flex-col items-center">
                            ${iconContainer.outerHTML}
                            <h3 class="text-sm font-medium text-center truncate w-full">${item.name}</h3>
                        </div>
                        <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2">
                            <button class="edit-item-btn w-8 h-8 rounded-full bg-dark-lighter flex items-center justify-center hover:bg-primary/20" data-id="${item.id}">
                                <i class="fa fa-pencil text-sm"></i>
                            </button>
                            <button class="delete-item-btn w-8 h-8 rounded-full bg-dark-lighter flex items-center justify-center hover:bg-red-500/20 text-red-400" data-id="${item.id}">
                                <i class="fa fa-trash text-sm"></i>
                            </button>
                        </div>
                    `;

                    // ç‚¹å‡»å¡ç‰‡æ‰“å¼€é“¾æ¥å¹¶è®°å½•è®¿é—®
                    appCard.addEventListener('click', (e) => {
                        // å¦‚æœç‚¹å‡»çš„æ˜¯ç¼–è¾‘æˆ–åˆ é™¤æŒ‰é’®ï¼Œåˆ™ä¸æ‰“å¼€é“¾æ¥
                        if (!e.target.closest('.edit-item-btn') && !e.target.closest('.delete-item-btn')) {
                            window.open(item.url, '_blank');
                            DataManager.recordAccess(item.id);

                            // å¦‚æœå½“å‰æ˜¯æœ€è¿‘è®¿é—®åˆ†ç»„ï¼Œé‡æ–°æ¸²æŸ“
                            if (DataManager.getCurrentGroup().id === 'recent') {
                                this.renderCurrentGroup();
                            }
                        }
                    });

                    // ç¼–è¾‘åº”ç”¨
                    appCard.querySelector('.edit-item-btn').addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.openEditItemModal(item.id);
                    });

                    // åˆ é™¤åº”ç”¨
                    appCard.querySelector('.delete-item-btn').addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.openDeleteItemConfirm(item.id);
                    });

                    appsGrid.appendChild(appCard);
                });
            },

            // æ‰“å¼€æ–°å¢åˆ†ç»„æ¨¡æ€æ¡†
            openAddGroupModal() {
                document.getElementById('group-modal-title').textContent = 'æ–°å¢åˆ†ç»„';
                document.getElementById('group-form').reset();
                document.getElementById('group-id').value = '';
                document.getElementById('group-modal').classList.remove('hidden');
                document.getElementById('group-name').focus();
            },

            // æ‰“å¼€ç¼–è¾‘åˆ†ç»„æ¨¡æ€æ¡†
            openEditGroupModal() {
                const currentGroup = DataManager.getCurrentGroup();
                if (!currentGroup || currentGroup.isDefault) return;

                document.getElementById('group-modal-title').textContent = 'ç¼–è¾‘åˆ†ç»„';
                document.getElementById('group-id').value = currentGroup.id;
                document.getElementById('group-name').value = currentGroup.name;
                document.getElementById('group-desc').value = currentGroup.desc || '';
                document.getElementById('group-modal').classList.remove('hidden');
                document.getElementById('group-name').focus();
            },

            // æ‰“å¼€åˆ é™¤åˆ†ç»„ç¡®è®¤
            openDeleteGroupConfirm() {
                const currentGroup = DataManager.getCurrentGroup();
                if (!currentGroup || currentGroup.isDefault) return;

                document.getElementById('confirm-title').textContent = 'åˆ é™¤åˆ†ç»„';
                document.getElementById('confirm-message').textContent = `æ‚¨ç¡®å®šè¦åˆ é™¤"${currentGroup.name}"åˆ†ç»„å—ï¼Ÿåˆ†ç»„å†…çš„æ‰€æœ‰åº”ç”¨ä¹Ÿå°†è¢«åˆ é™¤ã€‚`;
                document.getElementById('confirm-modal').classList.remove('hidden');

                // è®¾ç½®ç¡®è®¤æŒ‰é’®å›è°ƒ
                const confirmBtn = document.getElementById('confirm-delete-btn');
                // ç§»é™¤ä¹‹å‰çš„äº‹ä»¶ç›‘å¬
                confirmBtn.replaceWith(confirmBtn.cloneNode(true));
                // æ·»åŠ æ–°çš„äº‹ä»¶ç›‘å¬
                document.getElementById('confirm-delete-btn').addEventListener('click', () => {
                    DataManager.deleteGroup(currentGroup.id);
                    this.closeConfirmModal();
                    this.renderGroupTabs();
                    this.renderCurrentGroup();
                });
            },

            // æ‰“å¼€æ¸…ç©ºæœ€è¿‘è®¿é—®ç¡®è®¤
            openClearRecentConfirm() {
                document.getElementById('confirm-title').textContent = 'æ¸…ç©ºæœ€è¿‘è®¿é—®';
                document.getElementById('confirm-message').textContent = 'æ‚¨ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æœ€è¿‘è®¿é—®è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚';
                document.getElementById('confirm-modal').classList.remove('hidden');

                // è®¾ç½®ç¡®è®¤æŒ‰é’®å›è°ƒ
                const confirmBtn = document.getElementById('confirm-delete-btn');
                // ç§»é™¤ä¹‹å‰çš„äº‹ä»¶ç›‘å¬
                confirmBtn.replaceWith(confirmBtn.cloneNode(true));
                // æ·»åŠ æ–°çš„äº‹ä»¶ç›‘å¬
                document.getElementById('confirm-delete-btn').addEventListener('click', () => {
                    DataManager.clearRecentItems();
                    this.closeConfirmModal();
                    this.renderCurrentGroup();
                });
            },

            // æ‰“å¼€æ–°å¢åº”ç”¨æ¨¡æ€æ¡†
            openAddItemModal() {
                const currentGroupId = DataManager.getCurrentGroupId();
                document.getElementById('item-modal-title').textContent = 'æ–°å¢åº”ç”¨';
                document.getElementById('item-form').reset();
                document.getElementById('item-id').value = '';
                document.getElementById('item-group-id').value = currentGroupId;
                document.getElementById('item-modal').classList.remove('hidden');
                document.getElementById('item-name').focus();
            },

            // æ‰“å¼€ç¼–è¾‘åº”ç”¨æ¨¡æ€æ¡†
            openEditItemModal(itemId) {
                const currentGroupId = DataManager.getCurrentGroupId();
                const currentGroup = DataManager.getGroup(currentGroupId);
                const item = currentGroup.items.find(i => i.id === itemId);

                if (item) {
                    document.getElementById('item-modal-title').textContent = 'ç¼–è¾‘åº”ç”¨';
                    document.getElementById('item-id').value = item.id;
                    document.getElementById('item-group-id').value = currentGroupId;
                    document.getElementById('item-name').value = item.name;
                    document.getElementById('item-url').value = item.url;
                    document.getElementById('item-icon').value = item.icon || '';
                    document.getElementById('item-modal').classList.remove('hidden');
                    document.getElementById('item-name').focus();
                }
            },

            // æ‰“å¼€åˆ é™¤åº”ç”¨ç¡®è®¤
            openDeleteItemConfirm(itemId) {
                const currentGroupId = DataManager.getCurrentGroupId();
                const currentGroup = DataManager.getGroup(currentGroupId);
                const item = currentGroup.items.find(i => i.id === itemId);

                if (item) {
                    document.getElementById('confirm-title').textContent = 'åˆ é™¤åº”ç”¨';
                    document.getElementById('confirm-message').textContent = `æ‚¨ç¡®å®šè¦åˆ é™¤"${item.name}"å—ï¼Ÿ`;
                    document.getElementById('confirm-modal').classList.remove('hidden');

                    // è®¾ç½®ç¡®è®¤æŒ‰é’®å›è°ƒ
                    const confirmBtn = document.getElementById('confirm-delete-btn');
                    // ç§»é™¤ä¹‹å‰çš„äº‹ä»¶ç›‘å¬
                    confirmBtn.replaceWith(confirmBtn.cloneNode(true));
                    // æ·»åŠ æ–°çš„äº‹ä»¶ç›‘å¬
                    document.getElementById('confirm-delete-btn').addEventListener('click', () => {
                        DataManager.deleteItem(currentGroupId, itemId);
                        this.closeConfirmModal();
                        this.renderCurrentGroup();
                    });
                }
            },

            // å…³é—­åˆ†ç»„æ¨¡æ€æ¡†
            closeGroupModal() {
                document.getElementById('group-modal').classList.add('hidden');
            },

            // å…³é—­åº”ç”¨æ¨¡æ€æ¡†
            closeItemModal() {
                document.getElementById('item-modal').classList.add('hidden');
            },

            // å…³é—­ç¡®è®¤æ¨¡æ€æ¡†
            closeConfirmModal() {
                document.getElementById('confirm-modal').classList.add('hidden');
            },

            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            setupEventListeners() {
                // æ–°å¢åˆ†ç»„æŒ‰é’®
                document.getElementById('add-group-btn').addEventListener('click', () => {
                    this.openAddGroupModal();
                });

                // æ–°å¢åº”ç”¨æŒ‰é’®
                document.getElementById('add-item-btn').addEventListener('click', () => {
                    this.openAddItemModal();
                });

                // å…³é—­åˆ†ç»„æ¨¡æ€æ¡†
                document.getElementById('close-group-modal').addEventListener('click', () => {
                    this.closeGroupModal();
                });
                document.getElementById('cancel-group-btn').addEventListener('click', () => {
                    this.closeGroupModal();
                });

                // å…³é—­åº”ç”¨æ¨¡æ€æ¡†
                document.getElementById('close-item-modal').addEventListener('click', () => {
                    this.closeItemModal();
                });
                document.getElementById('cancel-item-btn').addEventListener('click', () => {
                    this.closeItemModal();
                });

                // å…³é—­ç¡®è®¤æ¨¡æ€æ¡†
                document.getElementById('cancel-confirm-btn').addEventListener('click', () => {
                    this.closeConfirmModal();
                });

                // æäº¤åˆ†ç»„è¡¨å•
                document.getElementById('group-form').addEventListener('submit', (e) => {
                    e.preventDefault();

                    const groupId = document.getElementById('group-id').value;
                    const groupData = {
                        name: document.getElementById('group-name').value,
                        desc: document.getElementById('group-desc').value
                    };

                    if (groupId) {
                        // æ›´æ–°åˆ†ç»„
                        DataManager.updateGroup(groupId, groupData);
                    } else {
                        // æ–°å¢åˆ†ç»„
                        const newGroup = DataManager.addGroup(groupData);
                        DataManager.setCurrentGroupId(newGroup.id);
                    }

                    this.closeGroupModal();
                    this.renderGroupTabs();
                    this.renderCurrentGroup();
                });

                // æäº¤åº”ç”¨è¡¨å•
                document.getElementById('item-form').addEventListener('submit', (e) => {
                    e.preventDefault();

                    const itemId = document.getElementById('item-id').value;
                    const groupId = document.getElementById('item-group-id').value;
                    const itemData = {
                        name: document.getElementById('item-name').value,
                        url: document.getElementById('item-url').value,
                        icon: document.getElementById('item-icon').value || ''
                    };

                    if (itemId) {
                        // æ›´æ–°åº”ç”¨
                        DataManager.updateItem(groupId, itemId, itemData);
                    } else {
                        // æ–°å¢åº”ç”¨
                        DataManager.addItem(groupId, itemData);
                    }

                    this.closeItemModal();
                    this.renderCurrentGroup();
                });
            }
        };

        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', () => {
            // åˆå§‹åŒ–æ•°æ®
            DataManager.init();
            // åˆå§‹åŒ–UI
            UIManager.init();
        });
    </script>
</body>

</html>
